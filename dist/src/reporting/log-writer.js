import path from "path";
export function generateMarkdownLog({ fromVersion, toVersion, deprecatedItems, autoFixes }) {
    const required = [];
    const optional = [];
    const fileMap = {};
    let ignoredCacheMatches = 0;
    deprecatedItems.forEach(item => {
        const isOptional = item.trim().startsWith("â„¹");
        if (isOptional)
            optional.push(item);
        else
            required.push(item);
        // Extract file reference
        const match = item.match(/â†’ (.*)$/);
        if (match) {
            const file = match[1].trim();
            if (file.includes(".angular/cache")) {
                ignoredCacheMatches++;
                return;
            }
            const cleaned = path.normalize(file);
            if (!fileMap[cleaned])
                fileMap[cleaned] = new Set();
            fileMap[cleaned].add(item.split("â†’")[0].trim());
        }
    });
    const affectedFiles = Object.keys(fileMap);
    const autofixesList = autoFixes ?? [];
    return `# Migration ${fromVersion} â†’ ${toVersion}

---

## ðŸš¨ Required Changes (may break project if ignored)
${required.length ? required.map(r => `- ${r}`).join("\n") : "âœ“ None â€” no blockers"}

---

## âš™ï¸ Autofixes Applied Automatically
${autofixesList.length ? autofixesList.map(a => `- ${a}`).join("\n") : "No autofixes applied"}

---

## ðŸ” Optional Improvements (not required but recommended)
${optional.length ? optional.map(o => `- ${o}`).join("\n") : "âœ“ No suggestions â€” this project is aligned with modern Angular"}

---

## ðŸ“Œ Files Needing Manual Attention
${affectedFiles.length ? affectedFiles.map(f => `- ${f}`).join("\n") : "âœ“ None"}

${ignoredCacheMatches > 0
        ? `\n> ðŸ”¹ ${ignoredCacheMatches} internal/cache files matched but were ignored intentionally â€” they do not require developer action.\n`
        : ""}

---

## ðŸ“Š Migration Summary
| Category | Count |
|----------|-------|
| Required changes | ${required.length} |
| Optional suggestions | ${optional.length} |
| Autofixes applied | ${autofixesList.length} |
| Files needing attention | ${affectedFiles.length} |
| Cache matches ignored | ${ignoredCacheMatches} |

---

ðŸ“„ Generated by **MigratorX â€” Quantum Migration Core**
`;
}
